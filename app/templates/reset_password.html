<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Restablecer contrase√±a | Gestor Documental</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { background:#f8f9fa; padding-top:80px; font-family:Arial,sans-serif; }
    .container { max-width:400px; background:white; border-radius:12px; padding:25px; box-shadow:0 0 12px rgba(0,0,0,0.1); }
</style>
</head>
<body>
<div class="container">
    <h4 class="text-center mb-3">üîë Restablecer contrase√±a</h4>
    <form id="reset-form">
        <div class="mb-3">
            <input type="text" id="token" class="form-control" placeholder="Token recibido" required>
        </div>
        <div class="mb-3">
            <input type="password" id="nueva_password" class="form-control" placeholder="Nueva contrase√±a" required>
        </div>
        <button type="submit" class="btn btn-success w-100">Restablecer contrase√±a</button>
    </form>
    <div id="mensaje" class="mt-3"></div>
    <p class="mt-2 text-center"><a href="/">Volver al login</a></p>
</div>

<script>
window.addEventListener("DOMContentLoaded", () => {
    // Prellenar token si est√° en localStorage
    const savedToken = localStorage.getItem("reset_token");
    if(savedToken) document.getElementById("token").value = savedToken;
});

document.getElementById("reset-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const token = document.getElementById("token").value.trim();
    const nueva_password = document.getElementById("nueva_password").value.trim();
    const mensaje = document.getElementById("mensaje");

    mensaje.innerHTML = "‚è≥ Restableciendo contrase√±a...";

    const formData = new FormData();
    formData.append("token", token);
    formData.append("nueva_password", nueva_password);

    try {
        const resp = await fetch("/auth/reset-password", { method: "POST", body: formData });
        const data = await resp.json();

        if(resp.ok){
            mensaje.innerHTML = `<div class="alert alert-success">‚úÖ ${data.mensaje}</div>`;
            localStorage.removeItem("reset_token");
            setTimeout(() => window.location.href = "/", 1500); // redirige al login
        } else {
            mensaje.innerHTML = `<div class="alert alert-danger">‚ùå ${data.detail || "Error al restablecer contrase√±a"}</div>`;
        }
    } catch(err){
        mensaje.innerHTML = `<div class="alert alert-danger">‚ùå Error de conexi√≥n: ${err}</div>`;
    }
});
</script>
</body>
</html>
