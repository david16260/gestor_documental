<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Recuperar contrase√±a | Gestor Documental</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { background:#f8f9fa; padding-top:80px; font-family:Arial,sans-serif; }
    .container { max-width:400px; background:white; border-radius:12px; padding:25px; box-shadow:0 0 12px rgba(0,0,0,0.1); }
</style>
</head>
<body>
<div class="container">
    <h4 class="text-center mb-3">üîí Recuperar contrase√±a</h4>
    <form id="forgot-form">
        <div class="mb-3">
            <input type="email" id="email" class="form-control" placeholder="Tu correo" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Enviar token</button>
    </form>
    <div id="mensaje" class="mt-3"></div>
    <p class="mt-2 text-center"><a href="/">Volver al login</a></p>
</div>
<script>
document.getElementById("forgot-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("email").value.trim();

    try {
        const resp = await fetch("/auth/forgot-password", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email })
        });

        const data = await resp.json();

        if(resp.ok){
            localStorage.setItem("reset_token", data.reset_token);
            document.getElementById("mensaje").innerHTML = '<div class="alert alert-success">‚úÖ Token generado. Redirigiendo...</div>';
            setTimeout(() => window.location.href = "/reset-password", 1000);
        } else {
            document.getElementById("mensaje").innerHTML = `<div class="alert alert-danger">‚ùå ${data.detail || "Error al generar token"}</div>`;
        }
    } catch(err){
        document.getElementById("mensaje").innerHTML = `<div class="alert alert-danger">‚ùå Error de conexi√≥n: ${err}</div>`;
    }
});
</script>
</body>
</html>
